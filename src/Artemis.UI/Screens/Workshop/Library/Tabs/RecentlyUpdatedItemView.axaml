<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:tabs="clr-namespace:Artemis.UI.Screens.Workshop.Library.Tabs"
             xmlns:il="clr-namespace:AsyncImageLoader;assembly=AsyncImageLoader.Avalonia"
             xmlns:avalonia="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
             xmlns:converters="clr-namespace:Artemis.UI.Converters"
             xmlns:mdxaml="https://github.com/whistyun/Markdown.Avalonia.Tight"
             xmlns:ui="clr-namespace:Artemis.UI"
             xmlns:workshop="clr-namespace:Artemis.WebClient.Workshop;assembly=Artemis.WebClient.Workshop"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="Artemis.UI.Screens.Workshop.Library.Tabs.RecentlyUpdatedItemView"
             x:DataType="tabs:RecentlyUpdatedItemViewModel">
    <UserControl.Resources>
        <converters:EntryIconUriConverter x:Key="EntryIconUriConverter" />
        <converters:DateTimeConverter x:Key="DateTimeConverter" />
        <ui:ArtemisLinkCommand x:Key="ArtemisLinkCommand" />
    </UserControl.Resources>
    <UserControl.Styles>
        <Style Selector="Border.badge">
            <Setter Property="Background" Value="{DynamicResource ControlSolidFillColorDefaultBrush}" />
            <Setter Property="CornerRadius" Value="12" />
            <Setter Property="Padding" Value="6 1"></Setter>
            <Setter Property="TextBlock.FontSize" Value="12" />
        </Style>
        <Style Selector="StackPanel.entry-clickable:pointerover TextBlock">
            <Setter Property="TextDecorations" Value="Underline" />
        </Style>
        <Style Selector="TextBlock.version-clickable:pointerover">
            <Setter Property="TextDecorations" Value="Underline" />
        </Style>
    </UserControl.Styles>
    <Border Padding="12"
            HorizontalAlignment="Stretch"
            Classes="card">
        <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto, Auto">
            <StackPanel Grid.Column="0"
                        Grid.Row="0"
                        Spacing="4"
                        Classes="entry-clickable"
                        Orientation="Horizontal"
                        Cursor="Hand"
                        Background="Transparent"
                        PointerPressed="Entry_OnPointerPressed">
                <!-- Icon -->
                <Border CornerRadius="2"
                        VerticalAlignment="Center"
                        Width="18"
                        Height="18"
                        ClipToBounds="True">
                    <Image Stretch="UniformToFill" il:ImageLoader.Source="{CompiledBinding Entry.Id, Converter={StaticResource EntryIconUriConverter}, Mode=OneWay}" />
                </Border>

                <!-- Title -->
                <TextBlock TextTrimming="CharacterEllipsis">
                    <Run Text="{CompiledBinding Entry.Name, FallbackValue=Title}" />
                    <Run Classes="subtitle">by</Run>
                    <Run Classes="subtitle" Text="{CompiledBinding Entry.Author, FallbackValue=Author}" />
                </TextBlock>
                <avalonia:MaterialIcon
                    IsVisible="{CompiledBinding Entry.IsOfficial}"
                    Kind="ShieldStar"
                    Foreground="{DynamicResource SystemAccentColorLight1}"
                    Margin="0 -2 0 0"
                    Width="18"
                    Height="18"
                    HorizontalAlignment="Left"
                    ToolTip.Tip="Official entry by the Artemis team" />
            </StackPanel>

            <StackPanel Grid.Column="1" Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="10">
                <TextBlock IsVisible="{CompiledBinding NotYetInstalled}">Not up-to-date</TextBlock>
                <Border Classes="badge" VerticalAlignment="Top">
                    <TextBlock Text="{CompiledBinding Entry.EntryType}"></TextBlock>
                </Border>
            </StackPanel>

            <ItemsControl Grid.Column="0" Grid.Row="1" Grid.ColumnSpan="2" ItemsSource="{CompiledBinding Releases}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="workshop:IGetRecentUpdates_Entries_Releases_Release">
                        <StackPanel Orientation="Vertical">
                            <Border Classes="card-separator" />
                            <Grid ColumnDefinitions="*,Auto" HorizontalAlignment="Stretch">
                                <TextBlock Grid.Column="0"
                                           Text="{CompiledBinding Version}"
                                           Classes="version-clickable"
                                           Cursor="Hand"
                                           Background="Transparent"
                                           PointerPressed="Release_OnPointerPressed" />
                                <TextBlock Grid.Column="1"
                                           Text="{CompiledBinding CreatedAt, Converter={StaticResource DateTimeConverter}, ConverterParameter='humanize'}"
                                           Classes="subtitle"
                                           HorizontalAlignment="Right" />
                            </Grid>
                            <TextBlock Classes="subtitle" IsVisible="{CompiledBinding Changelog, Converter={x:Static StringConverters.IsNullOrEmpty}}">
                                There are no release notes for this release.
                            </TextBlock>
                            <mdxaml:MarkdownScrollViewer Markdown="{CompiledBinding Changelog}"
                                                         MarkdownStyleName="FluentAvalonia"
                                                         IsVisible="{CompiledBinding Changelog, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                <mdxaml:MarkdownScrollViewer.Engine>
                                    <mdxaml:Markdown HyperlinkCommand="{StaticResource ArtemisLinkCommand}" />
                                </mdxaml:MarkdownScrollViewer.Engine>
                                <mdxaml:MarkdownScrollViewer.Styles>
                                    <StyleInclude Source="/Styles/Markdown.axaml" />
                                </mdxaml:MarkdownScrollViewer.Styles>
                            </mdxaml:MarkdownScrollViewer>
                        </StackPanel>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

        </Grid>
    </Border>
</UserControl>